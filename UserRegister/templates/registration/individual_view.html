{% extends 'base.html' %}

{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="row">
    <div id="user-profile" class="col-6 mx-auto">
        <div>
            <h3 class="mx-auto text-center fw-light">User Profile</h3>
            <hr>
        </div>
        <form id="msform" method="post">
            {% csrf_token %}
            {% if messages %}
            {% for message in messages %}
            <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
            {% endif %}


            <ul id="progressbar" class="d-flex justify-content-around mx-auto text-center" style="padding-left: 0px;">
                <li class="active" id="step1">Personal Details</li>
                <li id="step2">Location Details</li>
                <li id="step3">Sports Choices</li>
                <li id="step4">User Availability</li>
            </ul>

            <fieldset class="p-2" id="tab-1">
                <div class="card shadow">
                    <h4 class="card-header text-white text-center"
                        style="background: linear-gradient(170deg, rgba(71,176,239,1) 35%, rgba(13,223,246,1) 100%);">
                        Tell us little
                        about you</h4>
                        <div class="p-2 d-flex justify-content-end">
                            <input type="button" name="next" class="next action-button btn btn-primary"
                                   value="Next" id="next-tab-1" style="width: 90px;"/>
                        </div>
                    <div class="card-body">
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="first_name" placeholder="* First Name"
                                   value="{% if individual.first_name %} {{individual.first_name}} {% else %} None {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="last_name" placeholder="* Last Name"
                                   value="{% if individual.last_name %} {{individual.last_name}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input placeholder="* Birthday" class="textbox-n form-control" type="text"
                                   onfocus="(this.type='date')" onblur="(this.type='text')" name="dob"
                                   value="{% if individual.dob %} {{individual.dob}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="contact_email" placeholder="* Contact Email"
                                   value="{% if individual.email %} {{individual.email}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="mobile" placeholder="Mobile"
                                   value="{% if individual.phone %} {{individual.phone}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <label>* I am interest in participating in ?</label>
                            <br>
                            <label for="Male"></label><input type="checkbox" id="Male" name="interest_gender" value="Male"
                            {% if "Male" in individual.participation_interest %} checked {% endif %}> Male
                     Only</input></label>
                     <label for="Female"></label><input type="checkbox" id="Female" name="interest_gender" value="Female"
                            {% if "Female" in individual.participation_interest %} checked {% endif %}> Female
                     Only</input></label>
                     <label for="Coed"></label><input type="checkbox" id="Coed" name="interest_gender" value="Coed"
                            {% if "Coed" in individual.participation_interest %} checked {% endif %}>
                     Coed </input></label>
                        </div>
                        <div class="form-row p-2">
                            <label>Are you a Student?</label>
                            <br>
                            <label for="Yes"></label><input type="radio" id="Yes" name="is_student" value="Yes"
                                   {% if individual.is_student == "Yes" %} checked {% endif %}>Yes</input></label>
                            <label for="No"><input type="radio" id="No" name="is_student" value="No"
                                   {% if individual.is_student == "No" %} checked {% endif %}> No</input></label>
                        </div>
                        <div class="form-row p-2">
                            <label>Have you ever suffered concussion?</label>
                            <br>
                            <label for="Yes"></label><input type="radio" id="Yes" name="is_concussion" value="Yes"
                                   {% if individual.concussion == "Yes" %} checked {% endif %}>Yes</input></label>
                                   <label for="No"><input type="radio" id="No" name="is_concussion" value="No"
                                   {% if individual.concussion == "No" %} checked {% endif %}> No</input></label>
                        </div>
                    </div>
                </div>

            </fieldset>

            <fieldset class="p-2" id="tab-2">
                <div class="card shadow">
                    <h4 class="card-header text-white text-center"
                        style="background: linear-gradient(170deg, rgba(71,176,239,1) 35%, rgba(13,223,246,1) 100%);">
                        Hey {{ user.first_name }} list your locations where you can participate in </h4>
                        <div class="d-flex justify-content-between p-2">
                            <input type="button" name="previous"
                                   class="previous action-button-previous btn btn-primary"
                                   value="Previous" id="previous-tab-2" style="width: 90px;"/>
                            <input type="button" name="next" class="next action-button btn btn-primary"
                                   value="Next" id="next-tab-2" style="width: 90px;"/>
                        </div>
                    <div class="card-body">
                        <div id="location_status">

                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="city" id="city" placeholder="* City"
                                   value="{% if individual.city %} {{individual.city}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="province" id="province" placeholder="* Province"
                                   value="{% if individual.province %} {{individual.province}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2">
                            <input type="text" class="form-control" name="country" id="country" placeholder="* Country"
                                   value="{% if individual.country %} {{individual.country}} {% endif %}"/>
                        </div>
                        <div class="form-row p-2 text-center">
                            <div id="input_fields_wrap">
                                <input type="button" class="action-button btn btn-primary"
                                            id="add_locations" value="Add Location" />
                            </div>
                        </div>
                        <div class="form-row p-2 text-center">
                            <h5>Your Saved Locations</h5>
                            <div id="user_location_table">
                                <table class="table table-striped">
                                {% for item in locations %}
                                <tr>
                                    <td>{{item.city}}</td>
                                    <td>{{item.province}}</td>
                                    <td>{{item.country}}</td>
                                    <td>
                                        <a href="#"
                                           onclick="delete_user_location({{item.pk}})">
                                            <i class="bi bi-trash" style="color:red"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </table>
                            </div>
                        </div>

                    </div>
                </div>
            </fieldset>

            <fieldset class="p-2" id="tab-3">
                <div class="card shadow">
                    <h4 class="card-header text-white text-center"
                        style="background: linear-gradient(170deg, rgba(71,176,239,1) 35%, rgba(13,223,246,1) 100%);">
                        {{user.first_name }} ,
                        add sports you play and the ones you would love to play</h4>
                        <div class="d-flex justify-content-between p-2">
                            <input type="button" name="previous"
                                   class="previous action-button-previous btn btn-primary"
                                   value="Previous" id="previous-tab-3" style="width: 90px;"/>
                            <input type="button" name="next" class="next action-button btn btn-primary"
                                   value="Next" id="next-tab-3" style="width: 90px;"/>
                        </div>
                    <div class="card-body">
                        <div id="position_status">

                        </div>
                        <div class="form-row p-2">
                            <select name='sport_type' id="sports" class="form-select"
                                    aria-label=".form-select-lg example">
                                <option value="" selected>* Choose Sport</option>
                                {% for st in sports_type %}
                                <option value="{{st}}">{{st}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-row p-2" id="position_div">
                            <select name='position' class="form-select" id='position'
                                    aria-label=".form-select-lg example">
                                <option value=""
                                        {% if individual.sports_position == "" %} selected {% endif %}>
                                * Choose Position</option>
                            </select>
                        </div>
                        <div class="form-row p-2" id="skill_div">
                            <select name='skill' class="form-select" id='skill'
                                    aria-label=".form-select-lg example">
                                <option value="" selected>* Choose Skill</option>

                            </select>
                        </div>
                        <div class="form-row p-2 text-center">
                            <div id="input_fields">
                                <input type="button" class="action-button btn btn-primary"
                                        id="add_positions" value="Add Position" />
                            </div>
                        </div>
                        <div>
                            <h5>Your Saved Sport Preferences</h5>
                            <div id="sports_position_table">
                            <table class="table table-striped">
                                {% for item in sec_sport_choices %}
                                <tr>
                                    <td>{{item.sport_type}}</td>
                                    <td>{{item.position}}</td>
                                    <td>{{item.skill}}</td>
                                    <td>
                                        <a href="#"
                                           onclick="delete_sports_choice({{item.pk}})">
                                            <i class="bi bi-trash" style="color:red"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </table>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset class="p-2" id="tab-4">
                <div class="card shadow">
                    <h4 class="card-header text-white text-center"
                        style="background: linear-gradient(170deg, rgba(71,176,239,1) 35%, rgba(13,223,246,1) 100%);">
                        {{user.first_name }} ,
                        add your availability</h4>
                        <div class="p-2 d-flex justify-content-start">
                            <input type="button" name="previous"
                                   class="previous action-button-previous btn btn-primary"
                                   value="Previous" id="previous-tab-4" style="width: 90px;"/>
                        </div>
                    <div class="card-body">
                        <div id="availability_status">

                        </div>
                        <div id="add_avail_div" style="display:none">
                            <div class="form-group row p-2">
                                <div class="col-md-4">
                                    <label class="my-label">Day of Week</label>
                                    <select class="form-select" name="day_of_week" id="day_of_week">
                                        <option value="" selected="selected">Select Day Of The Week</option>
                                        <option value="1">Monday</option>
                                        <option value="2">Tuesday</option>
                                        <option value="3">Wednesday</option>
                                        <option value="4">Thursday</option>
                                        <option value="5">Friday</option>
                                        <option value="6">Saturday</option>
                                        <option value="7">Sunday</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <input type="time" class="form-control" id="start_time" name="start_time"
                                           placeholder="Start Time" value="00:00"/>
                                </div>
                                <div class="col-md-4">
                                    <input type="time" class="form-control" id="end_time" name="end_time"
                                           placeholder="End Time" value="23:59"/>
                                </div>
                            </div>
                            <div class="form-row p-2 text-center">
                                <label>I'm available all day</label>
                                <input type="checkbox" id="all_day" name="all_day" onchange="all_day_checked()"></input>

                            </div>
                            <div class="form-row p-2 text-center">
                                <input type="button" class="action-button btn btn-primary" id="add_availability"
                                       value="Add Availability"/>
                            </div>
                        </div>
                        <div class="form-row p-2 text-center">
                            <h5>Your Saved Availability Preferences</h5>
                            <div id="availability_table">
                                <table class="table table-striped">
                                    <thead style="font-weight:bold">
                                        <tr>
                                            <td>Day</td>
                                            <td>Start Time</td>
                                            <td>End Time</td>
                                            <td>All Day</td>
                                            <td>Delete</td>
                                            <td>Add</td>
                                            <td>Edit</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in user_avaiability %}
                                        <tr>
                                            <td>{{item.day_of_week}}</td>
                                            <td>{% if not item.all_day %} {{item.start_time}}
                                                {% else %} All Day
                                                {% endif %}</td>
                                            <td>{% if not item.all_day %} {{item.end_time}}
                                                {% else %} All Day
                                                {% endif %}</td>
                                            <td>
                                                <input type="checkbox"
                                                {% if item.all_day %} checked {% endif %} disabled></input>
                                            </td>
                                            <td>
                                                <a href="#"
                                                   onclick="delete_availability({{item.pk}})">
                                                    <i class="bi bi-trash" style="color:red"></i>
                                                </a>
                                            </td>
                                            <td>
                                                <a href="#"
                                                   onclick="show_availability('{{item.day_of_week}}', '{{item.start_time}}' , '{{item.end_time}}', 'Add', {{item.pk}})">
                                                    <i class="bi bi-plus-circle" style="color:green"></i>
                                                </a>
                                            </td>
                                            <td>
                                                <a href="#"
                                                   onclick="show_availability('{{item.day_of_week}}', '{{item.start_time}}' , '{{item.end_time}}', 'Edit', {{item.pk}})">
                                                    <i class="bi bi-pencil-square" style="color:blue"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                            </table>
                            </div>
                        </div>
                        <div class="form-row p-2 text-center">

                            <input type="submit" name="submit" class="submit action-button btn btn-primary"
                                   value="Submit" style="width: 90px;"/>
                        </div>
                    </div>
                </div>
            </fieldset>

        </form>
    </div>
</div>


<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js'></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>

<style>

   #progressbar {
    margin-bottom: 30px;
    overflow: hidden;
    color: lightgrey
}

#progressbar .active {
    color: #ff6f3d;
}

#progressbar li {
    display:inline-block;
    list-style-type: none;
    font-size: 15px;
    width: 20%;
    position: relative;
    font-weight: 400
}

#progressbar #step1:before {
    content: "1"
}

#progressbar #step2:before {
    content: "2"
}

#progressbar #step3:before {
    content: "3"
}

#progressbar #step4:before {
    content: "4"
}

#progressbar li:before {
    width: 40px;
    height: 40px;
    line-height: 35px;
    display: block;
    font-size: 20px;
    color: #ffffff;
    background: lightgray;
    border-radius: 50%;
    margin: 0 auto 10px auto;
    padding: 2px
}

@media only screen and (min-width: 768px) {
  /* For desktop: */
  #progressbar li:before {
    width: 50px;
    height: 50px;
    line-height: 45px;
    display: block;
    font-size: 20px;
    color: #ffffff;
    background: lightgray;
    border-radius: 50%;
    margin: 0 auto 10px auto;
    padding: 2px
}
}

#progressbar li.active:before,
#progressbar li.active:after {
    background: #ff6f3d
}





</style>

<script>


    function callWidthChange(myWidth, myHeight) {
        if (myWidth >= 768) {
            if(document.getElementById("user-profile")){
                document.getElementById("user-profile").classList.remove("col-12");
                document.getElementById("user-profile").classList.add("col-6");
            }
        } else {
            if(document.getElementById("user-profile")){
                document.getElementById("user-profile").classList.remove("col-6");
                document.getElementById("user-profile").classList.add("col-12");
            }
        }
    }

    $(document).ready(function () {
        let myWidth = window.innerWidth;
        let myHeight = window.innerHeight;
        callWidthChange(myWidth, myHeight);   
        $(window).resize(function () {
        var nw = $(window).width();
        let myHeight = window.innerHeight;
        myWidth = nw;
        callWidthChange(myWidth, myHeight);   
    });
    });
    $("#add_locations").click(function (e) {
        e.preventDefault();
        var selected_city_text = document.getElementById("city").value;
        var selected_province_text = document.getElementById("province").value;
        var selected_country_text = document.getElementById("country").value;

        $.ajax({
            type: "POST",
            url: '{% url "EventsApp:add_user_locations" %}',
            data: {
                'selected_city_text': selected_city_text,
                'selected_province_text': selected_province_text,
                'selected_country_text': selected_country_text,
                'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {
                let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
                html_data += `${data["status"]}`;
                html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
                html_data += `</div>`;
                let status = document.getElementById("location_status");
                status.innerHTML = html_data;
                fetchUserLocations();
            }
        });
    });

function fetchUserLocations(){
    $.ajax({
        type: "GET",
        async:false,
        url: '{% url "EventsApp:fetch_user_locations" %}',
        success: function (data) {
            let html_data = `<table class="table table-striped">`;
            data.forEach(function (data) {
                html_data += `<tr>`;
                html_data += `<td>${data.city}</td>`;
                html_data += `<td>${data.province}</td>`;
                html_data += `<td>${data.country}</td>`;
                html_data += `<td>`;
                html_data += `<a href="#" onclick="delete_user_location(${data.pk})">`;
                html_data += `<i class="bi bi-trash" style="color:red"></i>`;
                html_data += `</a>`;
                html_data += `</td>`;
                html_data += `</tr>`;
            });
            html_data += `</table>`;
            let tableData = document.getElementById("user_location_table");
            tableData.innerHTML = html_data;
        }
    });
}

function delete_user_location(user_location_id){
    $.ajax({
        type: "POST",
        url: '{% url "EventsApp:delete_user_location" %}',
        data: {
            'id': user_location_id,
            'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function (data) {
            let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
            html_data += `${data["status"]}`;
            html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            html_data += `</div>`;
            let status = document.getElementById("location_status");
            status.innerHTML = html_data;
            fetchUserLocations();
        }
    });
}


$("#sports").change(function () {
        var selected_type_value = $("#sports option:selected");
        var selected_type_text = selected_type_value.text();
        $.ajax({
            type: "POST",
            url: '{% url "EventsApp:get_selected_sports_positions" %}',
            data: {
                'selected_type_text': selected_type_text,
                'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {
                let html_data = '<option value="" selected disabled>Choose Position</option>';
                data.forEach(function (data) {
                    html_data += `<option value="${data.position_type}">${data.position_type}</option>`
                });
                $("#position").html(html_data);
            }
        });
    });


$("#add_positions").click(function (e) {
        e.preventDefault();
        var selected_skill_value = $("#skill option:selected");
        var selected_skill_text = selected_skill_value.text();
        var selected_position_value = $("#position option:selected");
        var selected_position_text = selected_position_value.text();
        var selected_sport_value = $("#sports option:selected");
        var selected_sport_text = selected_sport_value.text();

        console.log(selected_skill_value.val(), selected_position_value.val(), selected_sport_value.val());
        if(selected_skill_value.val() === "" || selected_position_value.val() === "" || selected_sport_value.val() === ""){
            let msg = "Please fill in he empty fields!";
            let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
            html_data += `${msg}`;
            html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            html_data += `</div>`;
            let status = document.getElementById("position_status");
            status.innerHTML = html_data;
        }
        else {
            $.ajax({
                type: "POST",
                url: '{% url "EventsApp:add_sports_positions" %}',
                data: {
                    'selected_sport_text': selected_sport_text,
                    'selected_position_text': selected_position_text,
                    'selected_skill_text': selected_skill_text,
                    'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function (data) {
                    let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
                    html_data += `${data["status"]}`;
                    html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
                    html_data += `</div>`;
                    let status = document.getElementById("position_status");
                    status.innerHTML = html_data;
                    fetchUserSportChoices();

                    $("#sports").val($("#skill option:first").val());

                    $('#position option:not(:first)').remove();
                    $("#position").val($("#position option:first").val());

                    $('#skill option:not(:first)').remove();
                    $("#skill").val($("#skill option:first").val());
                }
            });
        }
    });

function fetchUserSportChoices(){
    $.ajax({
        type: "GET",
        async:false,
        url: '{% url "EventsApp:fetch_user_sports_positions" %}',
        success: function (data) {
            let html_data = `<table class="table table-striped">`;
            data.forEach(function (data) {
                html_data += `<tr>`;
                html_data += `<td>${data.sport_type}</td>`;
                html_data += `<td>${data.position}</td>`;
                html_data += `<td>${data.skill}</td>`;
                html_data += `<td>`;
                html_data += `<a href="#" onclick="delete_sports_choice(${data.pk})">`;
                html_data += `<i class="bi bi-trash" style="color:red"></i>`;
                html_data += `</a>`;
                html_data += `</td>`;
                html_data += `</tr>`;
            });
            html_data += `</table>`;
            let tableData = document.getElementById("sports_position_table");
            tableData.innerHTML = html_data;
        }
    });
}

function delete_sports_choice(sport_choice_id){
    $.ajax({
        type: "POST",
        url: '{% url "EventsApp:delete_sports_choice" %}',
        data: {
            'id': sport_choice_id,
            'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function (data) {
            let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
            html_data += `${data["status"]}`;
            html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            html_data += `</div>`;
            let status = document.getElementById("position_status");
            status.innerHTML = html_data;
            fetchUserSportChoices();
        }
    });
}

$("#add_availability").click(function(e) {
    e.preventDefault();
    var day_of_week_value = $("#day_of_week option:selected");
    var day_of_week_text = day_of_week_value.val();
    var start_time_val = $("#start_time").val();
    var end_time_val = $("#end_time").val();
    var all_day_val = $("#all_day")[0].checked;

    if(start_time_val === "" || end_time_val === "" || day_of_week_text === ""){
        let msg = "Please fill in he empty fields!";
        let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
        html_data += `${msg}`;
        html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
        html_data += `</div>`;
        let status = document.getElementById("availability_status");
        status.innerHTML = html_data;
    }
    else{
        $.ajax({
            type: "POST",
            url: '{% url "EventsApp:add_user_availability" %}',
            data: {
                'day_of_week': day_of_week_text,
                'start_time': start_time_val,
                'end_time': end_time_val,
                'all_day': all_day_val,
                'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {
                let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
                html_data += `${data["status"]}`;
                html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
                html_data += `</div>`;
                let status = document.getElementById("availability_status");
                status.innerHTML = html_data;
                getUserAvailability();
            }
        });
     }
});

function getUserAvailability(){
    $.ajax({
        type: "GET",
        async:false,
        url: '{% url "EventsApp:get_user_availability" %}',
        success: function (data) {
            let html_data = `<table class="table table-striped"><thead style="font-weight:bold"><tr><td>Day</td><td>Start Time</td><td>End Time</td><td>All Day</td><td>Delete</td><td>Add</td><td>Edit</td></tr></thead><tbody>`;
            data.forEach(function (data) {
                html_data += `<tr>`;
                html_data += `<td>${data.day_of_week}</td>`;
                html_data += "<td>" + (!data.all_day ? data.start_time : "All Day") + "</td>";
                html_data += "<td>" + (!data.all_day ? data.end_time : "All Day") + "</td>";
                html_data += `<td>`;
                html_data += "<input type='checkbox' style='background-color:white' " + (data.all_day ? "checked" : "") + " disabled></input>";
                html_data += `</td>`;
                html_data += `<td>`;
                html_data += `<a href='#' onclick='delete_availability(${data.pk})'>`;
                html_data += `<i class="bi bi-trash" style="color:red"></i>`;
                html_data += `</a>`;
                html_data += `</td>`;
                html_data += `<td>`;
                html_data += `<a href='#' onclick="show_availability('${data.day_of_week}', '${data.start_time}', '${data.end_time}', 'Add', ${data.pk})">`;
                html_data += `<i class="bi bi-plus-circle" style="color:green"></i>`;
                html_data += `</a>`;
                html_data += `</td>`;
                html_data += `<td>`;
                html_data += `<a href='#' onclick="show_availability('${data.day_of_week}', '${data.start_time}' , '${data.end_time}', 'Edit', ${data.pk})">`;
                html_data += `<i class="bi bi-pencil-square" style="color:blue"></i>`;
                html_data += `</a>`;
                html_data += `</td>`;
                html_data += `</tr>`;
            });
            html_data += `</tbody></table>`;
            let tableData = document.getElementById("availability_table");
            tableData.innerHTML = html_data;
        }
    });
}


function delete_availability(availability_id){
    $.ajax({
        type: "POST",
        url: '{% url "EventsApp:delete_availability" %}',
        data: {
            'id': availability_id,
            'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
        },
        success: function (data) {
            let html_data = `<div class="alert alert-warning alert-dismissible fade show" role="alert">`;
            html_data += `${data["status"]}`;
            html_data += `<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;
            html_data += `</div>`;
            let status = document.getElementById("availability_status");
            status.innerHTML = html_data;
            getUserAvailability();
        }
    });
}

function show_availability(day_of_week, start_time, end_time, add_or_edit, pk){

    if(start_time == "midnight" || start_time == "All Day") start_time = "00:00";
    if(end_time == "midnight" || end_time == "All Day") end_time = "00:00";
    let week_days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    $('#day_of_week')[0].value =  week_days.indexOf(day_of_week) + 1;
    if (add_or_edit == "Edit"){
        delete_availability(pk);
        $("#add_availability")[0].value = "Save Changes";
        $('#start_time')[0].value = moment(start_time,['h:m a', 'H:m']).format("HH:mm").toString();
        $('#end_time')[0].value = moment(end_time,['h:m a', 'H:m']).format("HH:mm");
    }
    $("#add_avail_div").show();
}

function all_day_checked(){
    if($('#all_day')[0].checked){
        $('#start_time')[0].value = '00:00';
        $('#end_time')[0].value = '23:59';
        $('#start_time')[0].disabled = true;
        $('#end_time')[0].disabled = true;
    }
    else{
        $('#start_time')[0].disabled = false;
        $('#end_time')[0].disabled = false;
    }
}


$("#position").change(function () {
    var selected_position_value = $("#position option:selected");
    var selected_position_text = selected_position_value.text();
    var selected_type_value = $("#sports option:selected");
    var selected_type_text = selected_type_value.text();
    console.log(selected_position_text, selected_type_text);
        $.ajax({
            type: "POST",
            url: '{% url "EventsApp:get_selected_sports_skill" %}',
            data: {
                'selected_position_text': selected_position_text,
                'selected_type_text': selected_type_text,
                'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function (data) {
                let html_data = '<option value="" selected disabled>* Choose Skill</option>';
                data.forEach(function (data) {
                    html_data += `<option value="${data.skill_type}">${data.skill_type}</option>`
                });
                console.log(html_data);
                $("#skill").html(html_data);
            }
        });
    });

$(document).ready(function(){
  var tab2 = $("#tab-2");
  var tab3 = $("#tab-3");
  var tab4 = $("#tab-4");
  tab2.hide();
  tab3.hide();
  tab4.hide();

  $("#next-tab-1").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.hide();
    tab2.show();
    tab3.hide();
    tab4.hide();
    $("#step2").addClass("active");
  });

  $("#next-tab-2").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.hide();
    tab2.hide();
    tab3.show();
    tab4.hide();
    $("#step3").addClass("active");
  });

  $("#next-tab-3").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.hide();
    tab2.hide();
    tab3.hide();
    tab4.show();
    $("#step4").addClass("active");
  });

  $("#previous-tab-2").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.show();
    tab2.hide();
    tab3.hide();
    tab4.hide();
    $("#step2").removeClass("active");
  });

  $("#previous-tab-3").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.hide();
    tab2.show();
    tab3.hide();
    tab4.hide();
    $("#step3").removeClass("active");
  });

  $("#previous-tab-4").click(function(){
    var tab1 = $("#tab-1");
    var tab2 = $("#tab-2");
    var tab3 = $("#tab-3");
    var tab4 = $("#tab-4");
    tab1.hide();
    tab2.hide();
    tab3.show();
    tab4.hide();
    $("#step4").removeClass("active");
  });

});


// Logic to show alert when user leaving page without saving
$(function () {
    var formSubmitting = false;
    $("#msform").on('submit', function(){
        formSubmitting = true;
    });
    window.onload = function() {
        window.addEventListener("beforeunload", function (e) {
            if (formSubmitting) {
                return undefined;
            }

            var confirmationMessage = 'It appears you have unsaved changes, if you leave now, your changes will be lost.';

            (e || window.event).returnValue = confirmationMessage; //Gecko + IE
            return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
        });
    };
});

// Make Placeholders title when user types something
function addInputLabel(evt) {
    if (document.getElementsByName(evt.currentTarget.name)[0] && document.getElementsByName(evt.currentTarget.name)[0].type !== 'button'
    && document.getElementsByName(evt.currentTarget.name)[0].type !== 'checkbox'){
        // console.log(document.getElementsByName(evt.currentTarget.name)[0]);
        var myLabel = document.createElement('div');
        myLabel.textContent = evt.currentTarget.placeholder;
        myLabel.classList.add('my-label');
        if (document.getElementsByName(evt.currentTarget.name)[0]) {
            var parentDiv = document.getElementsByName(evt.currentTarget.name)[0].parentElement;
            if(parentDiv.getElementsByClassName('my-label').length < 1) {
                parentDiv.insertBefore(myLabel, evt.currentTarget);
            }
            else{
                if(evt.currentTarget.value.length == 0){
                    parentDiv.removeChild(parentDiv.getElementsByClassName('my-label')[0]);
                }
            }
        }
    }
}

var inputs = document.getElementsByTagName('input');
for (let i of inputs){
    i.addEventListener('input', addInputLabel, false);
    let event = new Event("input");
    i.dispatchEvent(event);
}

$(document).ready(function() {
  $(window).keydown(function(event){
    if(event.keyCode == 13) {
      event.preventDefault();
      return false;
    }
  });
});

</script>

{% endblock %}